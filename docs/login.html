<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CW Czar Pricing – Login</title>
  <link rel="stylesheet" href="./styles.css?v=12" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    .login-wrap{max-width:520px;margin:56px auto;padding:18px}
    .login-card{background:#fff;border:1px solid var(--stroke);border-radius:16px;box-shadow:var(--shadow-md);padding:22px}
    .login-title{margin:0 0 8px}
    .login-sub{color:var(--muted);margin:0 0 14px}
    .row{display:flex;gap:10px;margin:10px 0;align-items:center}
    .row label{min-width:120px}
    .error{color:#b91c1c;font-size:12px;margin-top:6px;display:none}
    .success{color:#14532d;font-size:12px;margin-top:6px;display:none}
    .login-actions{display:flex;gap:10px;align-items:center;margin-top:10px;flex-wrap:wrap}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <span class="brand-text" style="
        font-weight: 700;
        font-size: 1.3rem;
        color: var(--primary, #0f3a29);">
        CW Worldwide Czar Pricing
      </span>
    </div>
  </header>

  <main class="login-wrap">
    <section class="login-card">
      <h1 class="login-title">Welcome</h1>
      <p class="login-sub">Sign in or create an account to continue.</p>

      <!-- SIGN IN FORM -->
      <div id="panelSignIn">
        <div class="row"><label>Email</label><input id="siEmail" type="email" placeholder="you@company.com" /></div>
        <div class="row"><label>Password</label><input id="siPw" type="password" placeholder="••••••••" /></div>
        <div id="siErr" class="error"></div>

        <div class="login-actions">
          <button id="loginBtn" class="btn-primary" type="button">Sign in</button>
          <button id="createBtn" class="btn-subtle" type="button">Create account</button>
          <button id="demoBtn" class="btn-subtle" type="button">Demo login</button>
        </div>
      </div>

      <!-- CREATE ACCOUNT FORM (toggles in) -->
      <div id="panelCreate" style="display:none;">
        <div class="row"><label>Name</label><input id="suName" type="text" placeholder="Full name" /></div>
        <div class="row"><label>Email</label><input id="suEmail" type="email" placeholder="you@company.com" /></div>
        <div class="row"><label>Password</label><input id="suPw" type="password" placeholder="At least 6 characters" /></div>
        <div id="suErr" class="error"></div>
        <div id="suOk" class="success"></div>
        <div class="login-actions">
          <button id="createSubmit" class="btn-primary" type="button">Create account</button>
          <button id="cancelCreate" class="btn-subtle" type="button">Cancel</button>
        </div>
      </div>

      <p class="muted" style="margin-top:12px">Note: This is a demo-only front-end auth. For production we’ll switch to Firebase/Auth0.</p>
    </section>
  </main>

  <script type="module">
    import { login, isLoggedIn, signUp, signIn } from "./auth.js?v=1";

    const params = new URLSearchParams(location.search);
    const ret = params.get("ret") || "index.html";
    if (isLoggedIn()) location.replace(ret);

    // Elements
    const siEmail = document.getElementById("siEmail");
    const siPw    = document.getElementById("siPw");
    const siErr   = document.getElementById("siErr");

    const suName  = document.getElementById("suName");
    const suEmail = document.getElementById("suEmail");
    const suPw    = document.getElementById("suPw");
    const suErr   = document.getElementById("suErr");
    const suOk    = document.getElementById("suOk");

    const panelSignIn = document.getElementById("panelSignIn");
    const panelCreate = document.getElementById("panelCreate");

    // Toggle
    document.getElementById("createBtn").addEventListener("click", () => {
      panelSignIn.style.display = "none";
      panelCreate.style.display = "block";
    });
    document.getElementById("cancelCreate").addEventListener("click", () => {
      panelCreate.style.display = "none";
      panelSignIn.style.display = "block";
    });

    const showErr = (el,msg)=>{ el.textContent = msg; el.style.display = "block"; };
    const clearErr = (el)=>{ el.textContent = ""; el.style.display = "none"; };
    const validEmail = v => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);

    // Sign in
    document.getElementById("loginBtn").addEventListener("click", async ()=>{
      clearErr(siErr);
      try{
        await signIn({ email: siEmail.value, password: siPw.value });
        location.replace(ret);
      }catch(e){ showErr(siErr, e.message || "Sign in failed."); }
    });

    // Demo
    document.getElementById("demoBtn").addEventListener("click", async ()=>{
      try{
        await signIn({ email:"demo@example.com", password:"demopass" });
      }catch{
        await signUp({ name:"Demo", email:"demo@example.com", password:"demopass" });
      }
      location.replace(ret);
    });

    // Create account
    document.getElementById("createSubmit").addEventListener("click", async ()=>{
      suErr.style.display='none'; suOk.style.display='none';
      if(!suName.value.trim()) return showErr(suErr,"Name is required.");
      if(!validEmail(suEmail.value)) return showErr(suErr,"Enter a valid email.");
      if((suPw.value||"").length < 6) return showErr(suErr,"Password must be at least 6 characters.");
      try{
        await signUp({ name: suName.value, email: suEmail.value, password: suPw.value });
        suOk.textContent = "Account created. Redirecting…"; suOk.style.display='block';
        setTimeout(()=>location.replace(ret), 800);
      }catch(e){ showErr(suErr, e.message || "Could not create account."); }
    });
  </script>
</body>
</html>
