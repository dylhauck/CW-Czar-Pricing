<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login – CW Czar Pricing</title>
  <link rel="stylesheet" href="./styles.css?v=9">
</head>
<body>
  <main class="login-wrap">
    <section class="login-card">
      <h2 class="login-title">CW Czar Pricing</h2>
      <p class="login-sub">Sign in to continue</p>
      <div class="grid">
        <input type="email" id="email" placeholder="Email address" />
        <input type="password" id="pw" placeholder="Password" />
      </div>
      <div id="err" class="error" style="display:none;"></div>
      <div class="login-actions">
        <button id="loginBtn" class="btn-primary">Login</button>
        <button id="demoBtn" class="btn-subtle">Demo Login</button>
      </div>
      <p class="muted">By signing in you agree to CW Czar Pricing’s terms of use.</p>
    </section>
  </main>

  <script type="module">
    import { login, isLoggedIn } from "./auth.js?v=1";
    const params = new URLSearchParams(location.search);
    const ret = params.get("ret") || "index.html";
    if (isLoggedIn()) { location.replace(ret); }

    const email = document.getElementById("email");
    const pw = document.getElementById("pw");
    const err = document.getElementById("err");
    const validEmail = v => /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(v);

    document.getElementById("loginBtn").addEventListener("click", () => {
      err.style.display = "none"; err.textContent = "";
      if (!validEmail(email.value)) { err.textContent = "Enter a valid email."; err.style.display = "block"; return; }
      if ((pw.value || "").length < 6) { err.textContent = "Password must be at least 6 characters."; err.style.display = "block"; return; }
      login({ email: email.value, name: email.value.split("@")[0] });
      location.replace(ret);
    });

    document.getElementById("demoBtn").addEventListener("click", () => {
      login({ email: "demo@example.com", name: "Demo" });
      location.replace(ret);
    });
  </script>
</body>
</html>
