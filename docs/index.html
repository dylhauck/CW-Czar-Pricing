<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CW Czar Pricing | Rate a Shipment</title>
  <link rel="stylesheet" href="styles.css?v=29" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
</head>
<body>
  <!-- HEADER -->
  <header class="topbar">
    <div class="brand"><span class="brand-text">CW Czar Pricing</span></div>
    <nav class="topnav">
      <a href="index.html" class="active">Rate a Shipment</a>
      <a href="manage.html">Manage Settings</a>
      <a href="usage.html">Usage Report</a>
      <a href="accessorials.html">Accessorials</a>
    </nav>
    <div class="account">
      <a href="account.html" class="account-link">My Account</a>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container">
    <h2 class="title-center">Rate a Shipment</h2>

    <div class="rate-wrapper">
      <!-- LEFT -->
      <div class="form-section">
        <label>Origin ZIP</label>
        <input id="originZip" placeholder="e.g., 08873" />

        <label>Destination ZIP</label>
        <input id="destinationZip" placeholder="e.g., 60406" />

        <label>Class</label>
        <input id="class" placeholder="e.g., 70" />

        <label>Weight (lb)</label>
        <input type="number" id="weight" placeholder="e.g., 500" />

        <label>Miles</label>
        <input type="number" id="miles" placeholder="optional" />

        <!-- Fuel: TL below LTL -->
        <div class="form-group">
          <label class="section-label">Fuel Surcharge</label>
          <div class="fuel-wrap">
  <div class="fuel-row">
    <label>
      <input type="radio" name="fuelType" value="ltl" checked />
      LTL <span class="fuel-sub">(% on linehaul)</span>
    </label>
    <div class="fuel-input">
      <input type="number" id="ltlFuel" placeholder="e.g., 25" />
      <span class="fuel-unit">%</span>
    </div>
  </div>

  <div class="fuel-divider"></div>

  <div class="fuel-row">
    <label>
      <input type="radio" name="fuelType" value="tl" />
      TL <span class="fuel-sub">(¢ per mile)</span>
    </label>
    <div class="fuel-input">
      <input type="number" id="tlFuel" placeholder="e.g., 55" disabled />
      <span class="fuel-unit">¢</span>
    </div>
  </div>
</div>

        <label>MC Floor ($)</label>
        <input type="number" id="mcFloor" placeholder="optional" />

        <label>Accessorials ($)</label>
        <input type="number" id="accessorials" value="0.00" />

        <label>Select Saved Accessorial</label>
        <select id="savedAccessorials"></select>
        <button class="btn-subtle small-btn" id="addAccessorial">Add</button>

        <label>Discount (%)</label>
        <input type="number" id="discount" placeholder="e.g., 70" />

        <div class="actions">
          <button class="btn-primary" id="rateShipment">Rate Shipment</button>
          <button class="btn-subtle" id="clear">Clear</button>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="right-col">
        <div class="density-card">
          <h3>Density Calculator</h3>
          <div class="grid-4">
            <input type="number" id="length" placeholder="Length (in)" />
            <input type="number" id="width" placeholder="Width (in)" />
            <input type="number" id="height" placeholder="Height (in)" />
            <input type="number" id="pieces" placeholder="Pieces" />
          </div>
          <div class="density-meta">
            <div><strong>Density:</strong> <span id="density">—</span></div>
            <div><strong>Suggested Class:</strong> <span id="suggestedClass">—</span></div>
            <button class="btn-subtle small-btn" id="useSuggestedClass">Use Suggested Class</button>
          </div>
          <div class="density-note">Density and suggested class update automatically.</div>
        </div>

        <ul class="results-list" id="results">
          <li><strong>Gross</strong><span>—</span></li>
          <li><strong>Discount</strong><span>—</span></li>
          <li><strong>MC Floor</strong><span>—</span></li>
          <li><strong>Fuel Surcharge</strong><span>—</span></li>
          <li><strong>Accessorials</strong><span>—</span></li>
          <li><strong>Net</strong><span>—</span></li>
        </ul>
      </div>
    </div>
  </main>

  <footer>© 2025 CW Czar Pricing. All Rights Reserved.</footer>

  <!-- ===================== RATING ENGINE ===================== -->
  <script>
  // ----- PASTE YOUR TABLE HERE --------------------------------
  // CzarLite style $/cwt table by CLASS and WEIGHT BREAK.
  // Columns MUST be: L5C, M5C, M1M, M2M, M5M, M10M, M20M
  // Fill in values from your screenshot (examples below are placeholders!).
  const RATE_TABLE = {
    // class :  $/cwt per break
    500: { L5C: 1440.30, M5C: 1224.35, M1M: 1022.45, M2M: 907.65, M5M: 719.95, M10M: 645.40, M20M: 581.15 },
    400: { L5C: 1152.24, M5C: 979.48,  M1M: 817.96, M2M: 726.12, M5M: 575.96, M10M: 516.32, M20M: 464.92 },
    300: { L5C: 864.18,  M5C: 734.61,  M1M: 613.47, M2M: 544.59, M5M: 431.97, M10M: 387.24, M20M: 348.69 },
    250: { L5C: 720.15,  M5C: 612.18,  M1M: 511.23, M2M: 453.83, M5M: 359.98, M10M: 322.70, M20M: 290.58 },
    200: { L5C: 576.12,  M5C: 489.74,  M1M: 408.98, M2M: 363.06, M5M: 287.98, M10M: 258.16, M20M: 232.46 },
    175: { L5C: 504.11,  M5C: 428.52,  M1M: 357.86, M2M: 317.68, M5M: 251.98, M10M: 225.89, M20M: 203.40 },
    150: { L5C: 432.09,  M5C: 367.31,  M1M: 306.74, M2M: 272.30, M5M: 215.99, M10M: 193.62, M20M: 174.35 },
    125: { L5C: 360.08,  M5C: 306.09,  M1M: 255.61, M2M: 226.91, M5M: 179.99, M10M: 161.35, M20M: 145.29 },
    110: { L5C: 316.87,  M5C: 269.36,  M1M: 224.94, M2M: 199.68, M5M: 158.39, M10M: 141.99, M20M: 127.85 },
    100: { L5C: 288.06,  M5C: 244.87,  M1M: 204.49, M2M: 181.53, M5M: 143.99, M10M: 129.08, M20M: 116.23 },
     92: { L5C: 266.46,  M5C: 226.50,  M1M: 189.15, M2M: 167.92, M5M: 133.19, M10M: 119.40, M20M: 107.51 },
     85: { L5C: 244.85,  M5C: 208.14,  M1M: 173.82, M2M: 154.30, M5M: 122.39, M10M: 109.72, M20M:  98.80 },
     77: { L5C: 223.25,  M5C: 189.77,  M1M: 158.48, M2M: 140.69, M5M: 111.59, M10M: 100.04, M20M:  90.08 },
     70: { L5C: 208.84,  M5C: 177.53,  M1M: 148.26, M2M: 131.61, M5M: 104.39, M10M:  93.58, M20M:  84.27 },
     65: { L5C: 197.32,  M5C: 167.74,  M1M: 140.08, M2M: 124.35, M5M:  98.63, M10M:  88.42, M20M:  79.62 },
     60: { L5C: 182.92,  M5C: 155.49,  M1M: 129.85, M2M: 115.27, M5M:  91.43, M10M:  81.97, M20M:  73.81 },
     55: { L5C: 174.28,  M5C: 148.15,  M1M: 123.72, M2M: 109.83, M5M:  87.11, M10M:  78.09, M20M:  70.32 },
     50: { L5C: 159.87,  M5C: 135.90,  M1M: 113.49, M2M: 100.75, M5M:  79.91, M10M:  71.64, M20M:  64.51 }
  };

  // Weight breaks and required minimums for rating at that break
  const BREAKS = [
    { key: 'L5C',  minW:     0 },   // actual weight (no minimum above actual)
    { key: 'M5C',  minW:   500 },
    { key: 'M1M',  minW:  1000 },
    { key: 'M2M',  minW:  2000 },
    { key: 'M5M',  minW:  5000 },
    { key: 'M10M', minW: 10000 },
    { key: 'M20M', minW: 20000 }
  ];

  // ----- UI helpers
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  const num = (v, d=0) => {
    const n = parseFloat(v);
    return Number.isFinite(n) ? n : d;
  };

  // Fuel radio toggle
  $$('input[name="fuelType"]').forEach(r => {
    r.addEventListener('change', () => {
      $$('.fuel-option').forEach(o => o.classList.remove('active'));
      r.closest('.fuel-option').classList.add('active');
      const l = $('#ltlFuel'), t = $('#tlFuel');
      if (r.value === 'ltl') { l.disabled = false; t.disabled = true; }
      else { l.disabled = true; t.disabled = false; }
    });
  });

  // Density calc + suggested class
  ['length','width','height','pieces','weight'].forEach(id => {
    document.getElementById(id)?.addEventListener('input', calcDensity);
  });
  function calcDensity(){
    const L=num($('#length')?.value), W=num($('#width')?.value), H=num($('#height')?.value),
          P=num($('#pieces')?.value), WT=num($('#weight')?.value);
    if(!L||!W||!H||!P||!WT){ $('#density').textContent='—'; $('#suggestedClass').textContent='—'; return; }
    const cuft=(L*W*H*P)/1728, dens=WT/cuft; $('#density').textContent=dens.toFixed(2);
    const bands=[
      {min:0, max:1, cls:400},{min:1,max:2,cls:300},{min:2,max:4,cls:250},{min:4,max:6,cls:175},
      {min:6,max:8,cls:125},{min:8,max:10,cls:100},{min:10,max:12,cls:92.5},{min:12,max:15,cls:85},
      {min:15,max:22.5,cls:70},{min:22.5,max:30,cls:65},{min:30,max:35,cls:60},{min:35,max:50,cls:55},
      {min:50,max:Infinity,cls:50}
    ];
    const found=bands.find(b=>dens>=b.min&&dens<b.max);
    $('#suggestedClass').textContent=found?found.cls:'—';
  }
  $('#useSuggestedClass')?.addEventListener('click', ()=>{
    const s=$('#suggestedClass').textContent; if(s&&s!=='—') $('#class').value=s;
  });

  // ----- Rating (CzarLite-style $/cwt with deficit to break) -----
  function getRatePerCwt(cls, breakKey){
    // class keys are strings in RATE_TABLE; normalize (e.g., "92.5")
    const key=(+cls===92.5)?'92':String(cls);
    const row=RATE_TABLE[key]; if(!row) return null;
    return row[breakKey] ?? null;
  }

  function bestLinehaulCharge(cls, weightLb){
    // Evaluate every break: if actual < min, use min (deficit); else use actual.
    // Choose lowest charge.
    let best = { break: null, charge: Infinity, billW: 0, rate: 0 };
    for(const b of BREAKS){
      const r = getRatePerCwt(cls, b.key);
      if(r==null) continue;
      const billW = Math.max(weightLb, b.minW);
      const charge = (billW / 100) * r;
      if(charge < best.charge){
        best = { break: b.key, charge, billW, rate: r };
      }
    }
    return best; // {break, charge, billW, rate}
  }

  // ----- Click: Rate -----
  $('#rateShipment')?.addEventListener('click', ()=>{
    const cls = $('#class').value.trim();
    const wt  = num($('#weight')?.value);
    if(!cls || !wt){ alert('Enter class and weight.'); return; }

    // 1) Linehaul (gross) from table + deficit logic
    const best = bestLinehaulCharge(cls, wt);
    if(!isFinite(best.charge)){ alert('No rate found for class '+cls); return; }
    const linehaul = best.charge;

    // 2) Discount → MC Floor
    const discPct = num($('#discount')?.value);
    const discAmt = linehaul * (discPct/100);
    const afterDisc = linehaul - discAmt;
    const mc = num($('#mcFloor')?.value);
    const afterMC = Math.max(afterDisc, mc);

    // 3) Fuel
    const fuelType = (document.querySelector('input[name="fuelType"]:checked')?.value)||'ltl';
    let fuel = 0;
    if(fuelType==='ltl'){
      const pct = num($('#ltlFuel')?.value);
      fuel = afterMC * (pct/100);    // fuel on linehaul after discount/floor (your spec)
    }else{
      const cents = num($('#tlFuel')?.value);
      const miles = num($('#miles')?.value);
      fuel = miles * (cents/100);
    }

    // 4) Accessorials
    const accr = num($('#accessorials')?.value);

    // 5) Net
    const net = afterMC + fuel + accr;

    // Write results
    const rows = $$('#results li span');
    if(rows.length>=6){
      rows[0].textContent = linehaul.toFixed(2);        // Gross
      rows[1].textContent = `-${discAmt.toFixed(2)}`;   // Discount
      rows[2].textContent = mc.toFixed(2);              // MC Floor
      rows[3].textContent = fuel.toFixed(2);            // Fuel
      rows[4].textContent = accr.toFixed(2);            // Accessorials
      rows[5].textContent = net.toFixed(2);             // Net
    }
  });

  // Clear
  $('#clear')?.addEventListener('click', ()=>{
    ['originZip','destinationZip','class','weight','miles','ltlFuel','tlFuel','mcFloor','accessorials','discount','length','width','height','pieces']
      .forEach(id=>{ const el=document.getElementById(id); if(el) el.value=''; });
    $$('#results li span').forEach(s=>s.textContent='—');
    $('#density').textContent='—'; $('#suggestedClass').textContent='—';
    document.querySelector('input[name="fuelType"][value="ltl"]').checked = true;
    $('#ltlFuel').disabled=false; $('#tlFuel').disabled=true;
  });
  </script>
</body>
</html>
